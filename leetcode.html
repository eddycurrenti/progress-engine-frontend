<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sirin+Stencil&display=swap" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: "Sirin Stencil", sans-serif;
            background: radial-gradient(circle at 20% 20%, #0b1a35, #050c1f 60%);
            color: #e2e8f0;
            min-height: 100vh;
        }

        /* Container */
        .container {
    max-width: 1250px;
    margin: auto;
    padding: 50px 40px;   /* reduced vertical + horizontal padding */
}


        /* Heading */
        h1 {
            font-size: 34px;
            margin-bottom: 40px;
            letter-spacing: 1px;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.15);
        }

        /* Dashboard Layout */
        .dashboard {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 40px;
        }

        /* Glass Card */
        .card {
            background: rgba(30, 41, 59, 0.55);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            padding: 35px;
            border-radius: 22px;
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.4);
        }

        /* Inputs */
        input,
        select,
        textarea {
            width: 100%;
            padding: 14px;
            margin-bottom: 18px;
            border-radius: 14px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            background: rgba(15, 23, 42, 0.7);
            color: #e2e8f0;
            font-size: 14px;
            outline: none;
            transition: 0.3s ease;
        }

        input:focus,
        select:focus,
        textarea:focus {
            border-color: #132138;
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.4);
        }

        /* Textarea */
        textarea {
            height: 120px;
            resize: none;
        }

.header-buttons button {
    padding: 10px 22px;
    border-radius: 12px;
    font-size: 14px;
    font-weight: 600;
    min-width: 130px;
    height: 42px;
    border: none;
    cursor: pointer;
    transition: 0.25s ease;
}

/* Home button */
.logout {
    background: rgba(51, 65, 85, 0.9);
    color: #e2e8f0;
}

.logout:hover {
    background: rgba(71, 85, 105, 1);
}

/* Add Question button */
.header-buttons button:not(.logout) {
    background: linear-gradient(135deg, #352860, #252745);
    color: white;
}

.header-buttons button:not(.logout):hover {
    transform: translateY(-2px);
    box-shadow: 0 0 18px rgba(59, 130, 246, 0.45);
}


        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
        }

        .full-btn {
            width: 100%;
            margin-top: 5px;
        }

        /* Question Cards */
        .question {
            background: rgba(15, 23, 42, 0.7);
            padding: 18px;
            border-radius: 16px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: 0.3s ease;
        }

        .question:hover {
            background: rgba(15, 23, 42, 0.9);
            transform: translateY(-3px);
        }

        /* Stats */
        .stats-card {
            display: flex;
            flex-direction: column;
            gap: 35px;
        }

        /* Circle Progress Style */
        .stat {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .circle {
            width: 85px;
            height: 85px;
            border-radius: 50%;
            border: 6px solid;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 20px;
            background: rgba(15, 23, 42, 0.6);
        }

        .easy {
            border-color: #22c55e;
            box-shadow: 0 0 20px rgba(34, 197, 94, 0.4);
        }

        .medium {
            border-color: #f59e0b;
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.4);
        }

        .hard {
            border-color: #ef4444;
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.4);
        }

        .stat-label {
            font-size: 14px;
            color: #94a3b8;
        }

        /* Logout Button */
        /* Divider */
        hr {
            border: none;
            height: 1px;
            background: rgba(255, 255, 255, 0.08);
            margin: 40px 0;
        }

        /* Messages */
        .message {
            margin-top: 10px;
            font-size: 14px;
        }

        /* Disable body scroll when modal open */
        body.modal-open {
            overflow: hidden;
        }

        /* Overlay */
        .modal {
            position: fixed;
            inset: 0;
            display: none;
            align-items: center;
            justify-content: center;
            background: rgba(5, 12, 31, 0.65);
            backdrop-filter: blur(18px);
            z-index: 1000;
            animation: fadeOverlay 0.3s ease;
        }

        /* Premium Glass Card */
        .modal-content {
            width: 650px;
            max-height: 85vh;
            overflow-y: auto;
            padding: 40px;
            border-radius: 28px;
            background: linear-gradient(145deg,
                    rgba(30, 41, 59, 0.85),
                    rgba(15, 23, 42, 0.85));
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow:
                0 0 60px rgba(0, 0, 0, 0.6),
                0 0 40px rgba(59, 130, 246, 0.15);
            animation: scaleIn 0.35s cubic-bezier(.17, .67, .37, 1.35);
        }

        /* Hide Scrollbar (Premium look) */
        .modal-content::-webkit-scrollbar {
            width: 6px;
        }

        .modal-content::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 10px;
        }

        /* Floating Close Button */
        .modal-close {
            position: absolute;
            top: 25px;
            right: 30px;
            width: 42px;
            height: 42px;
            border-radius: 12px;
            background: linear-gradient(135deg, #ef4444, #dc2626);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            transition: 0.25s ease;
        }

        .modal-close:hover {
            transform: scale(1.08);
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.5);
        }

        /* Title */
        .modal-title {
            font-size: 22px;
            margin-bottom: 25px;
            letter-spacing: 0.5px;
        }

        .question-item {
            background: rgba(15, 23, 42, 0.6);
            border-radius: 18px;
            margin-bottom: 18px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            overflow: hidden;
            transition: 0.3s ease;
        }

        .question-header {
            padding: 18px 22px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .question-header:hover {
            background: rgba(15, 23, 42, 0.8);
        }

        .question-sub {
            font-size: 13px;
            color: #94a3b8;
            margin-top: 4px;
        }

        .arrow {
            transition: 0.3s ease;
            font-size: 14px;
        }

        .question-body {
            max-height: 0;
            overflow: hidden;
            padding: 0 22px;
            transition: max-height 0.4s ease, padding 0.3s ease;
            font-size: 14px;
        }

        .question-body pre {
            background: rgba(0, 0, 0, 0.4);
            padding: 12px;
            border-radius: 10px;
            overflow-x: auto;
            margin: 10px 0;
        }

        /* Active state */
        .question-item.active .question-body {
            max-height: 600px;
            padding: 20px 22px;
        }

        .question-item.active .arrow {
            transform: rotate(180deg);
        }

        .footer{
    text-align:center;
    padding:30px 10px;
    margin-top:50px;
    border-top:1px solid rgba(255,255,255,0.1);
    font-size:14px;
    color:#94a3b8;
}

        /* Animations */
        @keyframes scaleIn {
            from {
                transform: scale(0.92);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes fadeOverlay {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        /* Animation */
        @keyframes fadeIn {
            from {
                transform: scale(0.9);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }
.heatmap-wrapper {
    overflow-x: auto;
}

.month-row {
    display: grid;
    grid-auto-flow: column;
    grid-auto-columns: 14px;
    gap: 4px;
    margin-bottom: 8px;
    font-size: 12px;
    color: #94a3b8;
}

#heatmap {
    display: grid;
    grid-template-rows: repeat(7, 14px);
    grid-auto-flow: column;
    grid-auto-columns: 14px;
    gap: 4px;
}

.day {
    width: 14px;
    height: 14px;
    border-radius: 3px;
    background: #1e293b;
    transition: 0.2s ease;
}
.header-row {
    display: flex;
    align-items: center;
    gap: 40px;
    margin-bottom: 30px;
}

.top-section {
    display: grid;
    grid-template-columns: auto 1fr;
    gap: 50px;
    align-items: start;
    margin-bottom: 40px;
}

.left-header {
    display: flex;
    flex-direction: column;
}

.header-buttons {
    display: flex;
    gap: 15px;
    margin-top: 20px;
}

#heatmap {
    display: grid;
    grid-template-rows: repeat(7, 14px);
    grid-auto-flow: column;
    gap: 4px;
    width: 100%;
}


.heatmap-card {
    padding: 18px 22px;
    width: 100%;
}


.heatmap-wrapper {
    overflow-x: auto;
}

.month-row {
    display: grid;
    grid-auto-flow: column;
    grid-auto-columns: 14px;
    gap: 4px;
    margin-bottom: 8px;
    font-size: 12px;
    color: #94a3b8;
}

#heatmap {
    display: grid;
    grid-template-rows: repeat(7, 14px);
    grid-auto-flow: column;
    grid-auto-columns: 14px;
    gap: 4px;
}

.day {
    width: 14px;
    height: 14px;
    border-radius: 3px;
    background: #1e293b;
}

.day:hover {
    transform: scale(1.2);
}


        .error {
            color: #f87171;
        }

        .success {
            color: #4ade80;
        }

        /* Responsive */
        @media (max-width: 900px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }
        
    </style>
</head>

<body>

    <div class="container">

        <div class="top-section">

    <div class="left-header">
        <h1>LeetCode Progress</h1>

        <div class="header-buttons">
            <button class="logout" onclick="logout()">Home</button>
            <button onclick="openModal()">Add Question</button>
        </div>
    </div>

    <div class="card heatmap-card">
        <div class="heatmap-wrapper">
            <div id="monthLabels" class="month-row"></div>
            <div id="heatmap"></div>
        </div>
    </div>

</div>



        <div class="dashboard">

            <!-- LEFT -->
            <div class="card">
                <div id="questions" style="margin-top:20px;"></div>

            </div>
            <!-- MODAL OVERLAY -->
            <div id="questionModal" class="modal">
                <div class="modal-content">

                    <div class="modal-close" onclick="closeModal()">X</div>
                    <div class="modal-title">Add Today's Question</div>

                    <input type="text" id="problemId" placeholder="Problem ID">
                    <input type="text" id="title" placeholder="Title">

                    <select id="category">
                        <option value="">Category</option>
                        <option>Binary Search</option>
                        <option>Strings</option>
                        <option>Learn LinkedList</option>
                        <option>Recursion</option>
                        <option>Bit Manipulation</option>
                        <option>Stack and Queues</option>
                        <option>Sliding Window & Two Pointer Combined Problems</option>
                        <option>Heaps</option>
                        <option>Greedy Algorithms</option>
                        <option>Binary Trees</option>
                        <option>Binary Search Trees</option>
                        <option>Graphs</option>
                        <option>Dynamic Programming</option>
                    </select>

                    <input type="number" id="quesNumber" placeholder="Question Number">

                    <select id="level">
                        <option value="">Difficulty</option>
                        <option>Easy</option>
                        <option>Medium</option>
                        <option>Hard</option>
                    </select>

                    <textarea id="code" placeholder="Code"></textarea>
                    <input type="text" id="link" placeholder="LeetCode Link">
                    <textarea id="comments" placeholder="Comments (optional)"></textarea>

                    <button class="full-btn" onclick="storeQuestion()">Save</button>
                    <div id="message" class="message"></div>
                </div>
            </div>


            <!-- RIGHT STATS -->
            <div class="card stats-card">

                <div class="stat">
                    <div class="circle easy" id="easyCount">0</div>
                    <div>
                        <div style="font-weight:600;">Easy</div>
                        <div class="stat-label">Solved</div>
                    </div>
                </div>

                <div class="stat">
                    <div class="circle medium" id="mediumCount">0</div>
                    <div>
                        <div style="font-weight:600;">Medium</div>
                        <div class="stat-label">Solved</div>
                    </div>
                </div>

                <div class="stat">
                    <div class="circle hard" id="hardCount">0</div>
                    <div>
                        <div style="font-weight:600;">Hard</div>
                        <div class="stat-label">Solved</div>
                    </div>
                </div>

            </div>

        </div>

    </div>

    <div class="footer">
    <div><strong>Patil Tejas Ashok</strong></div>
    <div>reso49@gmail.com</div>
</div>

    <script>

        const BASE = "https://todo-qr-backend.onrender.com";

        if (!localStorage.getItem("token")) {
            window.location.href = "/login.html";
        }

        async function getAllQuestions() {
            const res = await fetch(`${BASE}/leetcode/user`, {
                headers: {
                    "Authorization": "Bearer " + localStorage.getItem("token")
                }
            });

            const container = document.getElementById("questions");
            container.innerHTML = "";

            if (!res.ok) {
                container.innerHTML = "<p>No data found</p>";
                return;
            }

            const data = await res.json();

            let easy = 0, medium = 0, hard = 0;

            data.forEach(q => {
                if (q.level === "Easy") easy++;
                if (q.level === "Medium") medium++;
                if (q.level === "Hard") hard++;

                container.innerHTML += `
    <div class="question-item">
        <div class="question-header" onclick="toggleQuestion(this)">
            <div>
                <strong>${q.title}</strong> (${q.level})
                <div class="question-sub">${q.category}</div>
            </div>
            <div class="arrow">â–¼</div>
        </div>

        <div class="question-body">
            <div><strong>Problem ID:</strong> ${q.problemId}</div>
            <div><strong>Question Number:</strong> ${q.quesNumber}</div>
            <div><strong>Code:</strong></div>
            <pre>${q.code}</pre>
            <div>
    <strong>Link:</strong>
            <a href="${q.link}" target="_blank" style="color:#3b82f6;">
        LeetCode
            </a>
        </div>
            <div><strong>Comments:</strong> ${q.comments || "None"}</div>
        </div>
    </div>
`;

            });

            document.getElementById("easyCount").innerText = easy;
            document.getElementById("mediumCount").innerText = medium;
            document.getElementById("hardCount").innerText = hard;
        }

        async function storeQuestion() {
            const messageBox = document.getElementById("message");
            messageBox.className = "message";
            messageBox.innerText = "";

            const body = {
                problemId: document.getElementById("problemId").value,
                title: document.getElementById("title").value,
                category: document.getElementById("category").value,
                quesNumber: document.getElementById("quesNumber").value,
                level: document.getElementById("level").value,
                code: document.getElementById("code").value,
                comments: document.getElementById("comments").value,
                link: document.getElementById("link").value
            };

            const res = await fetch(`${BASE}/leetcode/send`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": "Bearer " + localStorage.getItem("token")
                },
                body: JSON.stringify(body)
            });

            const data = await res.json();

            if (!res.ok) {
                messageBox.classList.add("error");
                messageBox.innerText = data.message || "Error";
                return;
            }

            messageBox.classList.add("success");
            messageBox.innerText = "Saved successfully";
        }

        function openModal() {
            document.getElementById("questionModal").style.display = "flex";
            document.body.classList.add("modal-open");
        }

        function closeModal() {
            document.getElementById("questionModal").style.display = "none";
            document.body.classList.remove("modal-open");
        }

        /* Click outside to close */
        window.addEventListener("click", function (e) {
            const modal = document.getElementById("questionModal");
            if (e.target === modal) closeModal();
        });

        /* ESC key close */
        window.addEventListener("keydown", function (e) {
            if (e.key === "Escape") closeModal();
        });



        function logout() {
            window.location.href = "/index.html";
        }

        function toggleQuestion(element) {
            const parent = element.parentElement;
            parent.classList.toggle("active");
        }
function createMonth(year, month) {
    const wrapper = document.createElement("div");
    wrapper.classList.add("month");

    const label = document.createElement("div");
    label.classList.add("month-label");
    label.innerText = new Date(year, month).toLocaleString("default", {
        month: "short"
    });

    const daysGrid = document.createElement("div");
    daysGrid.classList.add("days");

    wrapper.appendChild(label);
    wrapper.appendChild(daysGrid);

    return wrapper;
}

async function loadHeatmap() {
    const res = await fetch(`${BASE}/leetcode/heatmap`, {
        headers: {
            "Authorization": "Bearer " + localStorage.getItem("token")
        }
    });

    if (!res.ok) return;

    const result = await res.json();
    const { data, startDate } = result;
    if (!startDate) return;

    const heatmap = document.getElementById("heatmap");
    const monthLabels = document.getElementById("monthLabels");

    heatmap.innerHTML = "";
    monthLabels.innerHTML = "";

    const dayMap = {};
    data.forEach(d => {
        const key = `${d._id.year}-${d._id.month}-${d._id.day}`;
        dayMap[key] = d.count;
    });

    const first = new Date(startDate);
    const start = new Date(first.getFullYear(), first.getMonth(), 1);
    const today = new Date();

    let current = new Date(start);

    let lastMonth = -1;
    let columnIndex = 0;

    while (current <= today) {

        if (current.getDay() === 0) columnIndex++;

        if (current.getMonth() !== lastMonth) {
            const label = document.createElement("div");
            label.style.gridColumnStart = columnIndex;
            label.innerText = current.toLocaleString("default", { month: "short" });
            monthLabels.appendChild(label);
            lastMonth = current.getMonth();
        }

        const key = `${current.getFullYear()}-${current.getMonth() + 1}-${current.getDate()}`;
        const count = dayMap[key] || 0;

        const dayDiv = document.createElement("div");
        dayDiv.classList.add("day");

        if (count === 1) dayDiv.style.background = "#166534";
        else if (count === 2) dayDiv.style.background = "#16a34a";
        else if (count === 3) dayDiv.style.background = "#22c55e";
        else if (count >= 4) dayDiv.style.background = "#4ade80";

        heatmap.appendChild(dayDiv);

        current.setDate(current.getDate() + 1);
    }
}

        window.onload = () => {
            getAllQuestions();
            loadHeatmap();
        };

    </script>

</body>

</html>